# The lane line and the driving area segment branches without share information with each other and without link
YOLOP:
  [[105, 128, 151],   #Det_out_idx, Da_Segout_idx, LL_Segout_idx
      # [from, module, args]
      # from：输入来自那一层，-1代表上一次，1代表第1层，3代表第3层
      # module：子模块
      # args：模块参数，channel_in，channel_out，kernel_size，stride，padding，bias等]
   
    [-1, Conv, [3, 32, 3, 1]],  # 0            # 640

    [-1, Conv, [32, 64, 3, 2]],  # 1-P1/2      # 320
    [-1, Conv, [64, 64, 3, 1]],                # 320           

    [-1, Conv, [64, 128, 3, 2]],  # 3-P2/4     # 160
  # E-ELAN
    [-1, Conv, [128, 64, 1, 1]],               # 160
    [-2, Conv, [128, 64, 1, 1]],               # 160
    [-1, Conv, [64, 64, 3, 1]],                # 160
    [-1, Conv, [64, 64, 3, 1]],                # 160
    [-1, Conv, [64, 64, 3, 1]],                # 160
    [-1, Conv, [64, 64, 3, 1]],                # 160
    [[-1, -3, -5, -6], Concat, [1]],           # 160
  # E-ELAN
    [-1, Conv, [256, 256, 1, 1]],  # 11        # 160

  # MPConv
    [-1, MP, []],                              # 80
    [-1, Conv, [256, 128, 1, 1]],              # 80
    [-3, Conv, [256, 128, 1, 1]],              # 160
    [-1, Conv, [128, 128, 3, 2]],              # 80
    [[-1, -3], Concat, [1]],  # 16-P3/8        # 80
  # MPConv
 # E-ELAN
    [-1, Conv, [256, 128, 1, 1]],              # 80
    [-2, Conv, [256, 128, 1, 1]],              # 80
    [-1, Conv, [128, 128, 3, 1]],              # 80
    [-1, Conv, [128, 128, 3, 1]],              # 80
    [-1, Conv, [128, 128, 3, 1]],              # 80
    [-1, Conv, [128, 128, 3, 1]],              # 80
    [[-1, -3, -5, -6], Concat, [1]],           # 80
 # E-ELAN
    [-1, Conv, [512, 512, 1, 1]],  # 24        # 80
          
 # MPConv
    [-1, MP, []],                              # 40                  
    [-1, Conv, [512, 256, 1, 1]],              # 40 
    [-3, Conv, [512, 256, 1, 1]],              # 80 
    [-1, Conv, [256, 256, 3, 2]],              # 40 
    [[-1, -3], Concat, [1]],  # 29-P4/16       # 40 
  # MPConv
  # E-ELAN
    [-1, Conv, [512, 256, 1, 1]],              # 40
    [-2, Conv, [512, 256, 1, 1]],              # 40
    [-1, Conv, [256, 256, 3, 1]],              # 40
    [-1, Conv, [256, 256, 3, 1]],              # 40
    [-1, Conv, [256, 256, 3, 1]],              # 40
    [-1, Conv, [256, 256, 3, 1]],              # 40
    [[-1, -3, -5, -6], Concat, [1]],           # 40
  # E-ELAN
    [-1, Conv, [1024, 1024, 1, 1]],  # 37      # 40
          
  # MPConv
    [-1, MP, []],                              # 20  
    [-1, Conv, [1024, 512, 1, 1]],             # 20  
    [-3, Conv, [1024, 512, 1, 1]],             # 40  
    [-1, Conv, [512, 512, 3, 2]],              # 20  
    [[-1, -3], Concat, [1]],  # 42-P5/32       # 20 
  # MPConv
  #  E-ELAN
    [-1, Conv, [1024, 256, 1, 1]],             # 20
    [-2, Conv, [1024, 256, 1, 1]],             # 20
    [-1, Conv, [256, 256, 3, 1]],              # 20
    [-1, Conv, [256, 256, 3, 1]],              # 20
    [-1, Conv, [256, 256, 3, 1]],              # 20
    [-1, Conv, [256, 256, 3, 1]],              # 20
    [[-1, -3, -5, -6], Concat, [1]],           # 20
  #  E-ELAN
    [-1, Conv, [1024, 1024, 1, 1]],  # 50      # 20         

    #backbone




   [-1, SPPCSPC, [512]], # 51
  
   [-1, Conv, [512, 256, 1, 1]],
   [-1, nn.Upsample, [None, 2, 'nearest']],
   [37, Conv, [1024, 256, 1, 1]], # route backbone P4
   [[-1, -2], Concat, [1]],
   
# Catonv
   [-1, Conv, [512, 256, 1, 1]],
   [-2, Conv, [512, 256, 1, 1]],
   [-1, Conv, [256, 128, 3, 1]],
   [-1, Conv, [128, 128, 3, 1]],
   [-1, Conv, [128, 128, 3, 1]],
   [-1, Conv, [128, 128, 3, 1]],
   [[-1, -2, -3, -4, -5, -6], Concat, [1]],
# Catonv
   [-1, Conv, [1024, 256, 1, 1]], # 63
   
   [-1, Conv, [256, 128, 1, 1]],
   [-1, nn.Upsample, [None, 2, 'nearest']],
   [24, Conv, [512, 128, 1, 1]], # route backbone P3
   [[-1, -2], Concat, [1]], # 67

    #Neek 


# Catonv
   [-1, Conv, [256, 128, 1, 1]],
   [-2, Conv, [256, 128, 1, 1]],
   [-1, Conv, [128, 64, 3, 1]],
   [-1, Conv, [64, 64, 3, 1]],
   [-1, Conv, [64, 64, 3, 1]],
   [-1, Conv, [64, 64, 3, 1]],
   [[-1, -2, -3, -4, -5, -6], Concat, [1]],
# Catonv
   [-1, Conv, [512, 128, 1, 1]], # 75
    
# MPConv
   [-1, MP, []],
   [-1, Conv, [128, 128, 1, 1]],
   [-3, Conv, [128, 128, 1, 1]],
   [-1, Conv, [128, 128, 3, 2]],
   [[-1, -3, 63], Concat, [1]],
# MPConv
   
# Catonv
   [-1, Conv, [512, 256, 1, 1]],
   [-2, Conv, [512, 256, 1, 1]],
   [-1, Conv, [256, 128, 3, 1]],
   [-1, Conv, [128, 128, 3, 1]],
   [-1, Conv, [128, 128, 3, 1]],
   [-1, Conv, [128, 128, 3, 1]],
   [[-1, -2, -3, -4, -5, -6], Concat, [1]],
# Catonv
   [-1, Conv, [1024, 256, 1, 1]], # 88
      
# MPConv
   [-1, MP, []],
   [-1, Conv, [256, 256, 1, 1]],
   [-3, Conv, [256, 256, 1, 1]],
   [-1, Conv, [256, 256, 3, 2]],
   [[-1, -3, 51], Concat, [1]],
# MPConv
  
# Catonv
   [-1, Conv, [1024, 512, 1, 1]],
   [-2, Conv, [1024, 512, 1, 1]],
   [-1, Conv, [512, 256, 3, 1]],
   [-1, Conv, [256, 256, 3, 1]],
   [-1, Conv, [256, 256, 3, 1]],
   [-1, Conv, [256, 256, 3, 1]],
   [[-1, -2, -3, -4, -5, -6], Concat, [1]],
# Catonv
   [-1, Conv, [2048, 512, 1, 1]], # 101
   
   [75, RepConv, [128, 256, 3, 1]],
   [88, RepConv, [256, 512, 3, 1]],
   [101, RepConv, [512, 1024, 3, 1]],

   [[102,103,104], IDetect, [1, [[3,9,5,11,4,20], [7,18,6,39,12,31], 
                        [19,50,38,81,68,157]], [128, 256, 512]]],   # Detect(P3, P4, P5)
    
    # Detection head


    [ 67, Conv, [256, 128, 3, 1]],   #106
    [ -1, Upsample, [None, 2, 'nearest']],  #107

  #  E-ELAN
    [-1, Conv, [128, 64, 1, 1]],             
    [-2, Conv, [128, 64, 1, 1]],             
    [-1, Conv, [ 64, 64, 3, 1]],              
    [-1, Conv, [ 64, 64, 3, 1]],              
    [-1, Conv, [ 64, 64, 3, 1]],              
    [-1, Conv, [ 64, 64, 3, 1]],              
    [[-1, -3, -5, -6], Concat, [1]],           
  #  E-LAN
    [-1, Conv, [256, 64, 1, 1]],  # 115        

    [ -1, Conv, [64, 32, 3, 1]],    #116
    [ -1, Upsample, [None, 2, 'nearest']],  #117
    [ -1, Conv, [32, 16, 3, 1]],    #118

  #  E-ELAN
    [-1, Conv, [16, 8, 1, 1]],             
    [-2, Conv, [16, 8, 1, 1]],             
    [-1, Conv, [ 8, 8, 3, 1]],              
    [-1, Conv, [ 8, 8, 3, 1]],              
    [-1, Conv, [ 8, 8, 3, 1]],              
    [-1, Conv, [ 8, 8, 3, 1]],              
    [[-1, -3, -5, -6], Concat, [1]],           
  #  E-LAN
    [-1, Conv, [32, 8, 1, 1]],

    [ -1, Upsample, [None, 2, 'nearest']],  
    [ -1, Conv, [8, 2, 3, 1]], #128
    
    # Driving area segmentation head




    [ 67, Conv, [256, 128, 3, 1]],   #129
    [ -1, Upsample, [None, 2, 'nearest']],  #130

  #  E-ELAN
    [-1, Conv, [128, 64, 1, 1]],             
    [-2, Conv, [128, 64, 1, 1]],             
    [-1, Conv, [ 64, 64, 3, 1]],              
    [-1, Conv, [ 64, 64, 3, 1]],              
    [-1, Conv, [ 64, 64, 3, 1]],              
    [-1, Conv, [ 64, 64, 3, 1]],              
    [[-1, -3, -5, -6], Concat, [1]],           
  #  E-LAN
    [-1, Conv, [256, 64, 1, 1]],  #138

    [ -1, Conv, [64, 32, 3, 1]],    #139
    [ -1, Upsample, [None, 2, 'nearest']],  #140
    [ -1, Conv, [32, 16, 3, 1]],    # 141

  #  E-ELAN
    [-1, Conv, [16, 8, 1, 1]],             
    [-2, Conv, [16, 8, 1, 1]],             
    [-1, Conv, [ 8, 8, 3, 1]],              
    [-1, Conv, [ 8, 8, 3, 1]],              
    [-1, Conv, [ 8, 8, 3, 1]],              
    [-1, Conv, [ 8, 8, 3, 1]],              
    [[-1, -3, -5, -6], Concat, [1]],  # 148          
  #  E-LAN
    [-1, Conv, [32, 8, 1, 1]],

    [ -1, Upsample, [None, 2, 'nearest']],  #150
    [ -1, Conv, [8, 2, 3, 1]], #151
    
    # Lane line segmentation head
  ]
